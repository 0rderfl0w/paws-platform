---
const stats = [
  {
    number: 315,
    label: 'Esterilizados',
    sublabel: 'cães e gatos',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8" aria-hidden="true"><path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>`,
    color: 'text-nature-600',
    bg: 'bg-nature-50',
    border: 'border-nature-200',
  },
  {
    number: 419,
    label: 'Adotados',
    sublabel: 'novos lares felizes',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8" aria-hidden="true"><path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" /></svg>`,
    color: 'text-primary-600',
    bg: 'bg-primary-50',
    border: 'border-primary-200',
  },
  {
    number: 135,
    label: 'No Abrigo',
    sublabel: 'à espera de lar',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8" aria-hidden="true"><path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-1.72-1.72V5.25a.75.75 0 00-.75-.75h-1.5a.75.75 0 00-.75.75v1.79L12 2.15 1.72 12.47a.75.75 0 101.06 1.06l1.72-1.72V21a.75.75 0 00.75.75H9a.75.75 0 00.75-.75v-3.75h4.5V21a.75.75 0 00.75.75h3.75a.75.75 0 00.75-.75V11.81l1.72 1.72a.75.75 0 101.06-1.06L12.53 3.84z" /></svg>`,
    color: 'text-warm-600',
    bg: 'bg-warm-50',
    border: 'border-warm-200',
  },
];
---

<section class="bg-warm-50 py-16" aria-labelledby="stats-heading">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

    <div class="text-center mb-12">
      <h2 id="stats-heading" class="text-3xl font-bold text-warm-900 mb-3">O Nosso Impacto</h2>
      <p class="text-warm-600 text-lg">Números que contam histórias de amor e segunda oportunidade</p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 lg:gap-8">
      {stats.map(({ number, label, sublabel, icon, color, bg, border }) => (
        <div class={`relative ${bg} border ${border} rounded-2xl p-8 text-center shadow-sm hover:shadow-md transition-shadow`}>
          <div class={`inline-flex items-center justify-center w-16 h-16 ${bg} border ${border} rounded-2xl mb-4 mx-auto ${color}`}>
            <Fragment set:html={icon} />
          </div>
          <div
            class={`text-5xl font-extrabold mb-2 ${color} stat-counter`}
            data-target={number}
            aria-live="polite"
          >
            0
          </div>
          <div class="text-xl font-bold text-warm-900 mb-1">{label}</div>
          <div class="text-sm text-warm-500">{sublabel}</div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  function animateCounter(el: HTMLElement) {
    const target = parseInt(el.dataset.target || '0', 10);
    const duration = 1800;
    const startTime = performance.now();

    function update(currentTime: number) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      // Ease out cubic
      const eased = 1 - Math.pow(1 - progress, 3);
      el.textContent = Math.round(eased * target).toString();
      if (progress < 1) {
        requestAnimationFrame(update);
      } else {
        el.textContent = target.toString();
      }
    }

    requestAnimationFrame(update);
  }

  const counters = document.querySelectorAll<HTMLElement>('.stat-counter');

  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateCounter(entry.target as HTMLElement);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.4 }
    );
    counters.forEach((counter) => observer.observe(counter));
  } else {
    // Fallback: just show the numbers
    counters.forEach((counter) => {
      counter.textContent = counter.dataset.target || '0';
    });
  }
</script>
